<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<h:head>
    <title>Lab 3</title>
    <h:outputStylesheet name="styles/main.css"/>
</h:head>

<h:body>
    <header>
        <div id="author-block">
            <span id="author-information">Dinh Huy Hoang, P3231</span>
            <span id="variant">Variant: 1922</span>
        </div>
    </header>

    <div class="working-container">
        <div class="left-panel">
            <div class="upper-panel">
                <div class="label-area">Parameters</div>
                
                <h:form id="form">
                    <div class="input-zone">
                        <label class="labels" id="labelX">Coordinate X:</label>
                        <p:selectOneRadio id="x" 
                                        value="#{paramsBean.x}"
                                        styleClass="radio-x-group"
                                        required="true">
                            <f:selectItem itemLabel="-5" itemValue="-5"/>
                            <f:selectItem itemLabel="-4" itemValue="-4"/>
                            <f:selectItem itemLabel="-3" itemValue="-3"/>
                            <f:selectItem itemLabel="-2" itemValue="-2"/>
                            <f:selectItem itemLabel="-1" itemValue="-1"/>
                            <f:selectItem itemLabel="0" itemValue="0"/>
                            <f:selectItem itemLabel="1" itemValue="1"/>
                            <f:selectItem itemLabel="2" itemValue="2"/>
                            <f:selectItem itemLabel="3" itemValue="3"/>
                        </p:selectOneRadio>
                    </div>

                    <div class="input-zone">
                        <label class="labels" id="labelY">Coordinate Y:</label>
                        <div class="inputY">
                            <span/>
                            <p:inputText id="y"
                                       value="#{paramsBean.y}"
                                       styleClass="inputTextY"
                                       required="true"
                                       pt:placeholder="Enter Y value">
                                <f:validateDoubleRange minimum="-3" maximum="5"/>
                            </p:inputText>
                            <span class="condition"> [-3, 5] </span>
                        </div>
                    </div>

                    <div class="input-zone">
                        <label class="labels" id="labelR">Parameter R:</label>
                        <p:selectOneRadio id="R"
                                        value="#{paramsBean.r}"
                                        styleClass="radio-r-group"
                                        required="true">
                            <f:selectItem itemLabel="1" itemValue="1"/>
                            <f:selectItem itemLabel="1.5" itemValue="1.5"/>
                            <f:selectItem itemLabel="2" itemValue="2"/>
                            <f:selectItem itemLabel="2.5" itemValue="2.5"/>
                            <f:selectItem itemLabel="3" itemValue="3"/>
                            <p:ajax event="change" 
                                   process="@this" 
                                   update=":graphForm:gr"
                                   oncomplete="updateGraphR();"/>
                        </p:selectOneRadio>
                    </div>

                    <div class="button-container">
                        <p:commandButton id="submit"
                                       value="Submit"
                                       ajax="true"
                                       action="#{listBean.submit}"
                                       update="form final-results"
                                       process="@form"
                                       oncomplete="loadPointsFromJson(args.pointsJson); 
                                                  showResultOverlay(args.hit);"/>
                    </div>
                </h:form>
            </div>

            <div class="lower-panel">
                <div class="label-area">Results</div>
                
                <p:dataTable id="final-results"
                           value="#{listBean.model}"
                           var="p"
                           lazy="true"
                             rows="5"
                             paginator="true"
                             paginatorPosition="bottom"
                           styleClass="results-table">
                    <p:column headerText="Hit">
                        <h:outputText value="#{p.hit ? '✓' : '✗'}" 
                                    styleClass="#{p.hit ? 'hit-true' : 'hit-false'}"/>
                    </p:column>
                    <p:column headerText="X">#{p.x}</p:column>
                    <p:column headerText="Y">#{p.y}</p:column>
                    <p:column headerText="R">#{p.r}</p:column>
                    <p:column headerText="Time (ms)">
                        <h:outputText value="#{p.calTime}">
                            <f:convertNumber pattern="#0.000"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Timestamp">
                        <h:outputText value="#{p.releaseTime}">
                            <f:convertDateTime type="localDateTime" 
                                             pattern="dd/MM HH:mm:ss"/>
                        </h:outputText>
                    </p:column>
                </p:dataTable>
            </div>
        </div>

        <div class="right-panel">
            <div class="label-area">Illustration Graph</div>
            
            <canvas id="graph">
                <h:form id="graphForm" style="display:none">
                    <h:inputHidden id="gx" value="#{paramsBean.x}"/>
                    <h:inputHidden id="gy" value="#{paramsBean.y}"/>
                    <h:inputHidden id="gr" value="#{paramsBean.r}"/>
                    <p:commandButton id="graphSubmit"
                                   ajax="true"
                                   action="#{listBean.submit}"
                                   update=":form :final-results"
                                   process="@form"
                                   oncomplete="loadPointsFromJson(args.pointsJson); 
                                             showResultOverlay(args.hit);"/>
                </h:form>
            </canvas>
            
            <div class="coordinate-log">
                <label>Current X: <span id="screen-log-x">--</span></label>
                <label>Current Y: <span id="screen-log-y">--</span></label>
            </div>
        </div>
    </div>

    <div id="result-overlay" aria-live="polite">
        <span id="result-overlay-text"></span>
    </div>

    <div id="coor-tooltip"></div>

    <h:outputScript name="scripts/DrawingGraph.js"/>
    <h:outputScript name="scripts/DrawingPoints.js"/>
    <h:outputScript name="scripts/Main.js"/>
</h:body>
</html>
